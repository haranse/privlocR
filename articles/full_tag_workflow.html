<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Full Location Tag Workflow • privlocR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Full Location Tag Workflow">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">privlocR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/full_tag_workflow.html">Full Location Tag Workflow</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/haranse/privlocR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Full Location Tag Workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/haranse/privlocR/blob/main/vignettes/full_tag_workflow.Rmd" class="external-link"><code>vignettes/full_tag_workflow.Rmd</code></a></small>
      <div class="d-none name"><code>full_tag_workflow.Rmd</code></div>
    </div>

    
    
<p>Obtaining tag data for locations using privlocR is a two step
process. First, we need to download OpenStreetMap data for the general
area in which our location data is expected to be. Then, we can provide
privlocR with our locations and it will give us relevant tags,
completely offline.</p>
<div class="section level3">
<h3 id="data-download-from-the-web">Data download from the web<a class="anchor" aria-label="anchor" href="#data-download-from-the-web"></a>
</h3>
<p>We recommend downloading data from <a href="https://download.geofabrik.de/" class="external-link">Geofabrik</a>, which hosts
regularly updated OpenStreetMap data. The required files are
<code>osm.pbf</code> files. The homepage allows for downloading data for
whole continents; clicking on a continent name will go into a list of
sub regions (usually by country); some sub regions can be clicked on to
reveal even finer grained divisions. For example, clicking on South
America and then on Brazil will provide a list of sub regions of Brazil.
See below for guidelines on downloading data directly from R, using the
<code>osmextract</code> package, which might be useful in certain cases.
<strong>Importantly, we should save a backup of the map data to allow
for reproducibility, as the online map data changes over time.</strong>
This also means map data should be downloaded close to the time when
location data was collected.</p>
</div>
<div class="section level3">
<h3 id="generating-tags">Generating tags<a class="anchor" aria-label="anchor" href="#generating-tags"></a>
</h3>
<p>Once we have downloaded the appropriate files, we’re ready to
generate tags. We need to provide a directory with one or more
<code>osm.pbf</code> files, the distance from each location which we
want to search for tags, and the locations themselves. Note that
distances are provided using the <a href="https://github.com/r-quantities/units" class="external-link">units</a> package:
distances in meters can be provided using the syntax shown below
(<code>units::set_units(10, m)</code> is a distance of 10 meters), more
advanced options can be found in the <code>units</code> package
documentation.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/haranse/privlocR" class="external-link">privlocR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Directory that contains pbf files (the R temporary dir in this case)</span></span>
<span><span class="va">mydir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The distance around each location in which we want to search for tags</span></span>
<span><span class="va">mydst</span> <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">100</span>, <span class="va">m</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#longitude and latitude values</span></span>
<span><span class="va">long</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">9.1979860</span>, <span class="op">-</span><span class="fl">9.192079</span><span class="op">)</span></span>
<span><span class="va">lat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">171.8501176</span>, <span class="op">-</span><span class="fl">171.856883</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/get_close_tags.html">get_close_tags</a></span><span class="op">(</span><span class="va">mydir</span>, <span class="va">long</span>, <span class="va">lat</span>, dst <span class="op">=</span> <span class="va">mydst</span><span class="op">)</span></span>
<span><span class="co">#&gt; Re-reading with feature count reset from 52 to 29</span></span>
<span><span class="co">#&gt; Re-reading with feature count reset from 4 to 2</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "landuse_residential" "amenity_restaurant"  "natural_reef"       </span></span>
<span><span class="co">#&gt; [4] "natural_coastline"   "natural_scrub"       "tourism_hotel"      </span></span>
<span><span class="co">#&gt; [7] "leisure_park"        "building_yes"       </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] "natural_reef"      "natural_coastline" "natural_water"    </span></span>
<span><span class="co">#&gt; [4] "natural_wood"      "building_yes"</span></span></code></pre></div>
<p>As we can see, the data tells us that while both locations are close
to the ocean, the first is a more commercial area, around a hotel and a
restauarant, while the second is only next to some unrecognized
building. To ensure uniqueness, tags are composed of the OpenStreetMap
tag key and value, separated by an underscore. More information about
tags can be found on the OpenStreetMap <a href="https://wiki.openstreetmap.org/wiki/Tags" class="external-link">wiki</a>.</p>
</div>
<div class="section level2">
<h2 id="advanced-topics">Advanced Topics<a class="anchor" aria-label="anchor" href="#advanced-topics"></a>
</h2>
<div class="section level3">
<h3 id="runtimes">Runtimes<a class="anchor" aria-label="anchor" href="#runtimes"></a>
</h3>
<p>Run times for privlocR are dependant on the amount of map data
provided - if you provide map data for a whole continent privlocR will
take a long time to run even if your data is concentrated in a single
country or even city. Importantly, all files in the provided directory
are scanned, and so contribute to runtime. If running several analyses
concentrated on different geographical areas, only the map data relevant
to the current analysis should be in the provided directory.</p>
<p>privlocR provides limited caching - when running the exact same
analysis again, or an analysis with the exact same parameters except for
a reduced distance, analysis will be much faster. As such, if we want
taglists for multiple distances (e.g., one taglist to characterize a
broad area around each location and one to identify more specific
places), we should start with the larger distance and take care not to
change any other parameter, as so:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The distance around each location in which we want to search for tags</span></span>
<span><span class="va">mydst2</span> <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">10</span>, <span class="va">m</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#calling again, only changing the distance</span></span>
<span><span class="fu"><a href="../reference/get_close_tags.html">get_close_tags</a></span><span class="op">(</span><span class="va">mydir</span>, <span class="va">long</span>, <span class="va">lat</span>, dst <span class="op">=</span> <span class="va">mydst2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "landuse_residential" "amenity_restaurant"  "natural_reef"       </span></span>
<span><span class="co">#&gt; [4] "natural_coastline"   "tourism_hotel"       "building_yes"       </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] "natural_reef"      "natural_coastline"</span></span></code></pre></div>
<p>Now we see that the first location is specifically at an hotel
restaurant, and that for the second location, while we know from the
previous analysis that there is a building in the vicinity, the location
itself is in the open.</p>
</div>
<div class="section level3">
<h3 id="which-size-of-region-should-i-work-with">Which size of region should I work with?<a class="anchor" aria-label="anchor" href="#which-size-of-region-should-i-work-with"></a>
</h3>
<p>At the same time, remember that the whole goal of privlocR is not to
disclose the locations you are looking for online - downloading data for
a tiny village might let someone know that you had a participant there.
As a rule of thumb, working with under 0.5 gb of map data - a
medium-sized country (e.g., Cameroon) or a state or sub region of a
larger one (e.g., a region of India) - is manageable with a modern
computer. Working with around multiple gigabytes of data - a larger
country or whole continent (e.g., South America) might take about an
hour for the first run. In those cases try to make sure that you get all
of the required locations in one go, and if multiple distances are
required start with the largest distance to take advantage of the
caching system.</p>
</div>
<div class="section level3">
<h3 id="downloading-using-osmextract-">Downloading using osmextract.<a class="anchor" aria-label="anchor" href="#downloading-using-osmextract-"></a>
</h3>
<p>Data can also be downloaded directly from R using the package <a href="https://github.com/ropensci/osmextract" class="external-link">osmextract</a>. For
example, to download data for Tokelau which was used in the package
examples, one can run:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fname</span> <span class="op">=</span> <span class="fu">osmextract</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/osmextract/reference/oe_find.html" class="external-link">oe_find</a></span><span class="op">(</span><span class="st">"Tokelau"</span>,download_if_missing <span class="op">=</span> <span class="cn">TRUE</span>,allow_gpkg <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>(Note that <code>allow_gpkg = FALSE</code> tells the function to only
download an osm.pbf file; the function can also download a .gpkg file
which is not used by privlocR) The function returns a filename of a
temporary files, which should then be copied to a persistent directory
for backup. osmextract tries to find a file that matches the location
provided, which can be a name of a country, region or city.
Theoretically, if all locations are contained within a single city,
download might be smaller using osmextract that using geofabrik as
geofabrik only allows download of relatively large regions (osmextract
searches additional repositories beyond geofabrik). However, small
cities might not be found at all, and usually a region will be found on
geofabrik that contains the city and is not prohibitively large. More
information can be found in the <a href="https://github.com/ropensci/osmextract" class="external-link">osmextract</a>
documentation.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Haran Sened, European Research Council.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
